<% layout('layout') -%>
<div class="row">
	<div class="col-md-9">
		<ul class="list-group">
			<li class="list-group-item"><%= topic.title%></li>
			<li class="list-group-item"><%= topic.content%></li>
		</ul>
		<ul class="list-group">
			<li class="list-group-item"><%= topic.reply_count%>&nbsp;回复</li>
			<%
			for(var i=0; i<replies.length; i++){
			var reply = replies[i];
			%>
			
			<li class="list-group-item">
				<div class="reply">
					<div class="avatar"><a href="#"><img class="media-object avatar-48" src="https://ruby-china-files.b0.upaiyun.com/user/large_avatar/15774.jpg" alt="15774"></a></div>
					<div class="infos">
						<div class="info">
							<div>
								<a class="author" href="#"><%= reply.author.loginid %></a>
								<span>&nbsp;•&nbsp;<%= i+1 %>楼&nbsp;•&nbsp;</span>
								<span><%= reply.create_at_ago() %></span>
							</div>
							<%if(current_user){%>
							<div class="opts">
								<%if(current_user._id.toString() === reply.author._id.toString()){%>
								<a title="编辑" href="/reply/<%= reply._id%>/edit"><i class="fa fa-pencil" aria-hidden="true"></i></a>
								<%}%>
								<a title="赞" href="#"><i class="fa fa-thumbs-up" aria-hidden="true"></i></a>
								<a title="回复" href="#"><i class="fa fa-reply" aria-hidden="true"></i></a>
							</div>
							<%}%>
							
						</div>
						<div><%= reply.content%></div>
					</div>
				</div>
			</li>
			<%}%>
			
		</ul>
		<%if(current_user){%>
		<div class="list-group">
			<div class="list-group-item">添加回复</div>
			<div class="list-group-item">
			<ul class="nav nav-pills">
  <li role="presentation" class="edit-btn active"><a href="javascript:void(0)">编辑</a></li>
  <li role="presentation" class="preview-btn"><a href="javascript:void(0)">预览</a></li>
</ul>
				<form class="form-horizontal" action="/<%= topic._id%>/reply" method="post">
					<div class="form-group" id="editor">
						<div class="col-md-1"></div>
						<div class="col-md-11">
							<textarea class="form-control editor-text" id="r_content" name="r_content" rows="10" placeholder=""></textarea>
						</div>
						
					</div>
					<div class="form-group" id="preview">
						<div class="col-md-1"></div>
						<div class="col-md-11 preview-box">
3333
						</div>
						
					</div>
					<div class="form-group">
						<div class="col-md-1"></div>
						<div class="col-md-11">
							<input name="save-btn" type="submit" class="btn btn-success" value="回复"></input>
						</div>
					</div>
				</form>
			</div>
		</div>
		<%}%>
	</div>
	<div class="col-md-3"></div>
</div>
<% if (current_user && typeof(topic) !== 'undefined') { %>
<script type="text/javascript">
var allAuthors = $('.author').map(function (idx, ele) {
	return $(ele).text().trim();
}).toArray();
allAuthors = _.uniq(allAuthors);
$('#r_content').atwho({
	at: "@",
	data: allAuthors
});
autosize($('#r_content'));

$('.edit-btn').click(function(){
	$(this).addClass('active');
	$('.preview-btn').removeClass('active');
	$('#editor').toggle(true);
	$('#preview').toggle(false);
});
$('.preview-btn').click(function(){
	$(this).addClass('active');
	$('.edit-btn').removeClass('active');
	$('#editor').toggle(false);
	$('#preview').toggle(true);
});
</script>
<% } %>